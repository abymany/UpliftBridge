@model List<UpliftBridge.Models.NeedUpdate>

@{
    ViewData["Title"] = "Admin â€” Updates";
    var key = Context.Request.Query["key"].ToString();
    ViewBag.AdminKey = key;
}

<div class="kg-wrap kg-shell">
    <div class="kg-glass">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
            <div>
                <div class="kg-kicker">ADMIN</div>
                <h1 class="kg-title">Updates</h1>
                <p class="kg-muted mb-0">Moderation + transparency.</p>
            </div>

            <partial name="_AdminLinks" />
        </div>

        <hr style="border-color: rgba(255,255,255,.12);" />

        <div class="kg-card-light">
            <div class="table-responsive">
                <table class="table mb-0 kg-table">
                    <thead>
                        <tr>
                            <th style="width:70px;">ID</th>
                            <th>Need</th>
                            <th style="width:110px;">Type</th>
                            <th>Title</th>
                            <th style="width:110px;">Visible</th>
                            <th style="width:160px;">Created</th>
                            <th style="width:120px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model == null || Model.Count == 0)
                        {
                            <tr>
                                <td colspan="7" class="text-center text-muted p-4">No updates yet.</td>
                            </tr>
                        }
                        else
                        {
                            foreach (var u in Model)
                            {
                                <tr>
                                    <td class="text-muted">#@u.Id</td>
                                    <td>
                                        <div style="font-weight:900;">@((u.Need?.Title) ?? $"Need #{u.NeedId}")</div>
                                        <div class="small text-muted">NeedId: @u.NeedId</div>
                                    </td>
                                    <td>
                                        @if (u.IsThankYou) { <span class="badge bg-success">Thank you</span> }
                                        else { <span class="badge bg-secondary">Update</span> }
                                    </td>
                                    <td style="font-weight:900;">@u.Title</td>
                                    <td>
                                        @if (u.IsVisible) { <span class="badge bg-primary">Visible</span> }
                                        else { <span class="badge bg-dark">Hidden</span> }
                                    </td>
                                    <td class="small text-muted">@u.CreatedAtUtc.ToLocalTime().ToString("g")</td>
                                    <td class="text-end">
                                        <form asp-controller="Admin"
                                              asp-action="ToggleUpdateVisibility"
                                              asp-route-key="@key"
                                              method="post"
                                              class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@u.Id" />
                                            <button type="submit" class="kg-btn kg-btn-ghost">Toggle</button>
                                        </form>
                                    </td>
                                </tr>

                                <tr>
                                    <td colspan="7" class="small text-muted" style="padding-top:0;">
                                        <div style="padding:.65rem .9rem; border-top:1px solid rgba(15,23,42,.08); background:rgba(15,23,42,.03);">
                                            <strong>Message:</strong> @u.Message
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="mt-3">
            <a class="kg-btn kg-btn-ghost"
               asp-controller="Admin" asp-action="Index"
               asp-route-key="@key">Back to Admin</a>
        </div>
    </div>
</div>