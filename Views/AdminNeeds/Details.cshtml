@model UpliftBridge.Models.Need

@{
    ViewData["Title"] = "Admin â€” Need Preview";
    var key = (ViewBag.AdminKey as string) ?? "";
    var updates = ViewBag.Updates as System.Collections.IEnumerable;
    var photos = ViewBag.Photos as System.Collections.Generic.List<string> ?? new System.Collections.Generic.List<string>();
}

<div class="kg-wrap kg-shell">
  <div class="kg-glass">

    <div class="d-flex align-items-start justify-content-between flex-wrap gap-3">
      <div>
        <div class="kg-kicker">ADMIN PREVIEW</div>
        <h1 class="kg-title">@Model.Title</h1>

        <div class="d-flex flex-wrap gap-2 mt-2">
          @if (Model.IsPublished)
          {
            <span class="badge bg-success">Published</span>
          }
          else
          {
            <span class="badge bg-warning text-dark">Pending</span>
          }

          @if (!string.IsNullOrWhiteSpace(Model.RejectionReason) && !Model.IsPublished)
          {
            <span class="badge bg-danger">Rejected</span>
          }
        </div>

        @if (!string.IsNullOrWhiteSpace(Model.RejectionReason) && !Model.IsPublished)
        {
          <div class="text-danger mt-2"><strong>Rejection reason:</strong> @Model.RejectionReason</div>
        }
      </div>

      <div class="d-flex gap-2 flex-wrap">
        <a class="kg-btn kg-btn-ghost"
           asp-controller="AdminNeeds" asp-action="Index"
           asp-route-key="@key">Back</a>

        @if (!Model.IsPublished)
        {
          <form asp-controller="AdminNeeds" asp-action="Approve"
                asp-route-key="@key"
                method="post" class="d-inline">
            @Html.AntiForgeryToken()
            <input type="hidden" name="id" value="@Model.Id" />
            <button type="submit"
                    class="kg-btn"
                    style="background:#16a34a;border-color:#16a34a;color:#fff;">
              Approve
            </button>
          </form>
        }
      </div>
    </div>

    <hr style="border-color: rgba(255,255,255,.12);" />

    <div class="row g-4">
      <div class="col-lg-7">

        <div class="kg-card-light p-3">
          <div class="text-muted small mb-2">Need Details</div>

          <div class="d-flex flex-wrap gap-3">
            <div><span class="text-muted">Category:</span> <strong>@Model.Category</strong></div>
            <div><span class="text-muted">Location:</span> <strong>@Model.Location</strong></div>
            <div><span class="text-muted">Goal:</span> <strong>@Model.GoalAmount.ToString("C")</strong></div>
            <div><span class="text-muted">Raised:</span> <strong>@Model.AmountRaised.ToString("C")</strong></div>
          </div>

          <div class="mt-3">
            <div class="text-muted small mb-1">Description</div>
            <pre style="white-space:pre-wrap; margin:0; font-family:inherit;">@Model.Description</pre>
          </div>
        </div>

        @if (photos != null && photos.Count > 0)
        {
          <div class="kg-card-light p-3 mt-3">
            <div class="text-muted small mb-2">Photos</div>
            <div class="d-flex flex-wrap gap-2">
              @foreach (var p in photos)
              {
                <a href="@p" target="_blank" rel="noopener">
                  <img src="@p" alt="Need photo"
                       style="width:120px;height:90px;object-fit:cover;border-radius:12px;border:1px solid rgba(0,0,0,.08);" />
                </a>
              }
            </div>
          </div>
        }

      </div>

      <div class="col-lg-5">

        <div class="kg-card-light p-3">
          <div class="text-muted small mb-2">Admin Actions</div>

          @if (!Model.IsPublished)
          {
            <form asp-controller="AdminNeeds" asp-action="Reject"
                  asp-route-key="@key"
                  method="post">
              @Html.AntiForgeryToken()
              <input type="hidden" name="id" value="@Model.Id" />

              <label class="form-label small text-muted">Rejection reason (required)</label>
              <input type="text" name="reason" class="form-control" required />

              <button type="submit"
                      class="kg-btn mt-2"
                      style="background:#dc2626;border-color:#dc2626;color:#fff;">
                Reject
              </button>
            </form>
          }
          else
          {
            <div class="text-muted">This need is already published.</div>

            <a class="kg-btn kg-btn-ghost mt-2"
               asp-controller="Needs" asp-action="Details"
               asp-route-id="@Model.Id">
              Open Public Page
            </a>
          }
        </div>

      </div>
    </div>

  </div>
</div>